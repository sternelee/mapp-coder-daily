(wx.webpackJsonp=wx.webpackJsonp||[]).push([[12],{"16":function(e,t,n){"use strict";n.r(t);var o=n(5),a=n.n(o);for(var r in o)"default"!==r&&function(e){n.d(t,e,function(){return o[e]})}(r);t.default=a.a},"25":function(e,t,n){e.exports=n.p+"pages/index/index.wxml"},"43":function(e,t,n){"use strict";n.r(t);n(44);var o=n(16);for(var a in o)"default"!==a&&function(e){n.d(t,e,function(){return o[e]})}(a)},"44":function(e,t,n){"use strict";n(25)},"45":function(e){e.exports=JSON.parse('{"miniprogramRoot":"./dist","projectname":"mapp-coder-daily","description":"程序猿日常","appid":"wx47cf84f458781f68","setting":{"urlCheck":true,"es6":false,"postcss":false,"minified":false},"compileType":"miniprogram"}')},"46":function(e,t,n){},"5":function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{"value":!0});var f=_interopRequireDefault(n(14)),Ie=function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function sliceIterator(e,t){var n=[],o=!0,a=!1,r=void 0;try{for(var i,s=e[Symbol.iterator]();!(o=(i=s.next()).done)&&(n.push(i.value),!t||n.length!==t);o=!0);}catch(e){a=!0,r=e}finally{try{!o&&s.return&&s.return()}finally{if(a)throw r}}return n}(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")},_=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o])}return e},o=function(e,t,n){return t&&defineProperties(e.prototype,t),n&&defineProperties(e,n),e};function defineProperties(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}var a,r,i=n(15),Me=n(0),g=_interopRequireDefault(Me),s=n(13),m=n(3),u=_interopRequireDefault(n(45));function _interopRequireDefault(e){return e&&e.__esModule?e:{"default":e}}function _asyncToGenerator(e){return function(){var i=e.apply(this,arguments);return new Promise(function(a,r){return function step(e,t){try{var n=i[e](t),o=n.value}catch(e){return void r(e)}if(!n.done)return Promise.resolve(o).then(function(e){step("next",e)},function(e){step("throw",e)});a(o)}("next")})}}function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}n(46);var p,l,c=(function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{"constructor":{"value":e,"enumerable":!1,"writable":!0,"configurable":!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(Index,Me.Component),o(Index,[{"key":"_constructor","value":function _constructor(){(function get(e,t,n){null===e&&(e=Function.prototype);var o=Object.getOwnPropertyDescriptor(e,t);if(void 0===o){var a=Object.getPrototypeOf(e);return null===a?void 0:get(a,t,n)}if("value"in o)return o.value;var r=o.get;return void 0!==r?r.call(n):void 0})(Index.prototype.__proto__||Object.getPrototypeOf(Index.prototype),"_constructor",this).apply(this,arguments),this.state={"top":0,"show":!0,"pub":"","keyword":"","innerHeight":750,"tag":"","type":"latest","title":"Daily 最新动态","hits":[],"showTabsOptions":!1,"isRefresh":!1},this.$$refs=new g.default.RefsArray}},{"key":"componentWillMount","value":(l=_asyncToGenerator(f.default.mark(function _callee6(){var t,n,o;return f.default.wrap(function _callee6$(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,g.default.getMenuButtonBoundingClientRect();case 2:return t=e.sent,e.next=5,g.default.getSystemInfoSync();case 5:return n=e.sent,this.setState({"top":t.top+2,"innerHeight":n.windowHeight}),e.next=9,this.props.indexStore.initSetting();case 9:(!(o=g.default.getStorageSync("refreshTime"))||Number(o)>=(new Date).getTime()+6048e5)&&(this.setState({"isRefresh":!0}),g.default.setStorage({"key":"refreshTime","data":(new Date).getTime()}));case 11:case"end":return e.stop()}},_callee6,this)})),function componentWillMount(){return l.apply(this,arguments)})},{"key":"componentDidMount","value":(p=_asyncToGenerator(f.default.mark(function _callee7(){return f.default.wrap(function _callee7$(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getPost(!1);case 2:this.getPopularTags(),this.getPubs();case 4:case"end":return e.stop()}},_callee7,this)})),function componentDidMount(){return p.apply(this,arguments)})},{"key":"componentWillUnmount","value":function componentWillUnmount(){}},{"key":"componentWillReact","value":function componentWillReact(){}},{"key":"onShareAppMessage","value":function onShareAppMessage(e){return"button"===e.from&&console.log(e.target),{"title":"程序猿日报","path":"pages/index/index","success":function success(e){console.log("转发成功:"+JSON.stringify(e))},"fail":function fail(e){console.log("转发失败:"+JSON.stringify(e))}}}},{"key":"componentDidShow","value":function componentDidShow(){var e=this.props.indexStore;e.isAuth||e.getAuth()}},{"key":"componentDidHide","value":function componentDidHide(){}},{"key":"_createData","value":function _createData(e,t,n){var i=this;this.__state=e||this.state||{},this.__props=t||this.props||{};var s=this.$prefix,o=(0,Me.genCompid)(s+"$compid__36"),a=Ie(o,2),r=a[0],u=a[1],p=(0,Me.genCompid)(s+"$compid__37"),l=Ie(p,2),c=l[0],d=l[1],f=(0,Me.genCompid)(s+"$compid__38"),_=Ie(f,2),g=_[0],m=_[1],h=(0,Me.genCompid)(s+"$compid__39"),y=Ie(h,2),b=y[0],S=y[1],v=(0,Me.genCompid)(s+"$compid__40"),x=Ie(v,2),w=x[0],P=x[1],T=(0,Me.genCompid)(s+"$compid__41"),$=Ie(T,2),O=$[0],k=$[1],C=(0,Me.genCompid)(s+"$compid__42"),z=Ie(C,2),I=z[0],M=z[1],D=(0,Me.genCompid)(s+"$compid__43"),R=Ie(D,2),j=R[0],L=R[1],q=(0,Me.genCompid)(s+"$compid__44"),A=Ie(q,2),B=A[0],G=A[1],U=(0,Me.genCompid)(s+"$compid__45"),F=Ie(U,2),H=F[0],N=F[1],E=(0,Me.genCompid)(s+"$compid__46"),J=Ie(E,2),W=J[0],V=J[1],Q=(0,Me.genCompid)(s+"$compid__47"),X=Ie(Q,2),K=X[0],Y=X[1],Z=this.__state,ee=(Z.title,Z.top),te=Z.show,ne=Z.pub,oe=Z.tag,ae=(Z.keyword,Z.innerHeight),re=(Z.hits,Z.showTabsOptions,this.__props.indexStore),ie=re.list,se=re.posts,ue=re.allPubs,pe=re.allTags,le=re.tags,ce=re.pubs,de=re.setting,fe=re.favPids,_e=ne?ue.filter(function(e){return e.id===ne})[0]:{"image":"","name":""},ge=ce.includes(ne),me=le.includes(oe),he=ue.filter(function(e){return ce.includes(e.id)}),ye=fe.map(function(e){return se[e]}),be=de.language[1],Se="#323E70",ve=(0,Me.internal_inline_style)({"color":"#1c1e21","padding":ee+"px 0 10px 10px","height":"35px"});this.anonymousFunc0=function(){return i.__props.indexStore.setSetting("show",!0)};var xe=(0,Me.internal_inline_style)({"transform":"translateX("+(te?"-50%":"0")+")"}),we=(0,Me.internal_inline_style)({"height":ae-ee-50+"px"}),Pe=(0,Me.internal_inline_style)({"marginTop":"30px"}),Te=0===fe.length?(0,Me.internal_inline_style)({"color":"#a9abb3","textAlign":"center","padding":"10px 0"}):null,$e=(0,Me.internal_inline_style)({"height":ae-ee-50+"px"}),Oe=ne?(0,Me.internal_inline_style)({"display":"flex","alignItems":"center"}):null,ke=ne?(0,Me.internal_inline_style)({"color":ge?"#f58301":Se}):null,Ce=oe?(0,Me.internal_inline_style)({"color":me?"#f58301":Se}):null,ze=ie.map(function(e,t){e={"$original":(0,Me.internal_get_original)(e)};var n=(0,Me.genCompid)(s+"czzzzzzzzz"+t,!0),o=Ie(n,2),a=o[0],r=o[1];return Me.propsManager.set({"pid":e.$original,"post":se[e.$original],"setting":de,"onPost":i.onPost,"onTag":i.onTag,"onPub":i.onPub},r,a),{"$compid__35":r,"$original":e.$original}});return Me.propsManager.set({"setting":de,"onSet":re.setSetting.bind(re),"show":de.show},u,r),Me.propsManager.set({"name":"gengduo","size":40,"color":Se},d,c),Me.propsManager.set({"name":"Settingscontroloptions","size":40,"color":Se},m,g),Me.propsManager.set({"name":"caidan","size":50,"color":Se},S,b),Me.propsManager.set({"name":"rss","size":50,"color":Se},P,w),Me.propsManager.set({"name":"tag","size":50,"color":Se},k,O),Me.propsManager.set({"name":"sousuo","size":36,"color":"#000"},M,I),Me.propsManager.set({"name":"more1","size":50,"color":Se},L,j),Me.propsManager.set({"name":"more1","size":50,"color":Se},G,B),Me.propsManager.set({"name":"shoucang","size":50,"color":Se},N,H),ne&&Me.propsManager.set({"name":"rss","size":40,"color":ge?"#f58301":Se},V,W),oe&&Me.propsManager.set({"name":"tag","size":40,"color":me?"#f58301":Se},Y,K),Object.assign(this.__state,{"anonymousState__temp":ve,"anonymousState__temp2":xe,"anonymousState__temp3":we,"anonymousState__temp4":Pe,"anonymousState__temp5":Te,"anonymousState__temp6":$e,"anonymousState__temp7":Oe,"anonymousState__temp8":ke,"anonymousState__temp9":Ce,"loopArray14":ze,"$compid__36":u,"$compid__37":d,"$compid__38":m,"$compid__39":S,"$compid__40":P,"$compid__41":k,"$compid__42":M,"$compid__43":L,"$compid__44":G,"$compid__45":N,"$compid__46":V,"$compid__47":Y,"setting":de,"mypubs":he,"pubs":ce,"tags":le,"allPubs":ue,"allTags":pe,"favPids":fe,"favPost":ye,"thePub":_e,"isPub":ge,"isTag":me,"list":ie,"itemLan":be}),this.__state}},{"key":"anonymousFunc0","value":function anonymousFunc0(){}}]),r=a=Index,a.$$events=["onShowPage","anonymousFunc0","onTabs","onChangeTab","onPub","onTag","onSearch","onLikeTag","onPost","onNext","onLikePub"],a.$$componentPath="pages/index/index",r);function Index(){var e,t,c,d=this;!function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,Index);for(var n,o,a=arguments.length,r=Array(a),i=0;i<a;i++)r[i]=arguments[i];return(t=c=_possibleConstructorReturn(this,(e=Index.__proto__||Object.getPrototypeOf(Index)).call.apply(e,[this].concat(r)))).$usedState=["anonymousState__temp","anonymousState__temp2","anonymousState__temp3","anonymousState__temp4","anonymousState__temp5","anonymousState__temp6","anonymousState__temp7","anonymousState__temp8","anonymousState__temp9","loopArray14","$compid__36","$compid__37","$compid__38","$compid__39","$compid__40","$compid__41","$compid__42","$compid__43","$compid__44","$compid__45","$compid__46","$compid__47","showTabsOptions","setting","mypubs","pubs","tags","keyword","hits","allPubs","allTags","favPids","favPost","pub","thePub","isPub","tag","isTag","list","itemLan","title","top","show","innerHeight","type","isRefresh","indexStore"],c.config={"navigationBarTitleText":u.default.description,"navigationStyle":"custom"},c.getPubs=_asyncToGenerator(f.default.mark(function _callee(){var t;return f.default.wrap(function _callee$(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,g.default.getStorageSync("publications");case 2:(t=e.sent)&&!c.state.isRefresh?c.props.indexStore.allPubs=t:g.default.request({"url":m.Uri+"daily/v1/publications"}).then(function(e){c.props.indexStore.allPubs=e.data,g.default.setStorageSync("publications",e.data)});case 4:case"end":return e.stop()}},_callee,d)})),c.getPopularTags=_asyncToGenerator(f.default.mark(function _callee2(){var t;return f.default.wrap(function _callee2$(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,g.default.getStorageSync("popularTags");case 2:(t=e.sent)&&!c.state.isRefresh?c.props.indexStore.allTags=t:g.default.request({"url":m.Uri+"daily/v1/tags/popular"}).then(function(e){t=e.data.map(function(e){return e.name}),c.props.indexStore.allTags=t,g.default.setStorageSync("popularTags",t)});case 4:case"end":return e.stop()}},_callee2,d)})),c.getPost=function(){var i=!(0<arguments.length&&void 0!==arguments[0])||arguments[0],s=c.props.indexStore,u=s.page,e=c.state,t=e.type,n=e.pub,o=e.tag;i&&g.default.showLoading({"title":"Loading ..."});var a,p={"latest":['"sortBy":"popularity"',"fetchLatest","QueryPostInput","latest","latest"],"pub":['"pub":"'+n+'"',"fetchPostsByPublication","PostByPublicationInput","postsByPublication","postsByPublication"],"tag":['"tag":"'+o+'"',"fetchPostsByTag","PostByTagInput","postsByTag","postsByTag"]}[t],r="query "+p[1]+"($params: "+p[2]+") { "+p[3]+"(params: $params) { id,title,url,publishedAt,createdAt,image,ratio,placeholder,views,readTime,publication { id, name, image },tags } }",l='{"params":{"latest":"'+(new Date).toISOString()+'","page":'+u+',"pageSize":20,'+p[0]+"}}";"latest"===t&&(l=JSON.stringify(c.fetchLatestVariables())),g.default.request({"url":m.Uri+"daily/graphql","data":{"query":r,"variables":l}}).then((a=_asyncToGenerator(f.default.mark(function _callee3(t){var n,o,a,r;return f.default.wrap(function _callee3$(e){for(;;)switch(e.prev=e.next){case 0:return n=t.data.data,o=n[p[4]],c.props.indexStore.more=20===o.length,e.next=5,c.savePosts(o.map(function(e){return{"id":e.id,"title":e.title}}));case 5:a=e.sent,r=o.map(function(e){return s.setPost(_({},e,{"title_cn":a[e.id]})),e.id}),s.setList(r,0<u),i&&g.default.hideLoading();case 9:case"end":return e.stop()}},_callee3,d)})),function(e){return a.apply(this,arguments)})).catch(function(){i&&g.default.hideLoading(),g.default.showToast({"title":"数据拉取失败","duration":2e3})})},c.fetchLatestVariables=function(){var e=c.props.indexStore,t=e.setting.tabId?[]:e.tags;return{"params":_({"latest":(new Date).toISOString(),"page":e.page,"pageSize":20},t&&{"tags":t.join()},{"sortBy":e.setting.order})}},c.onPub=function(e){c.props.indexStore.page=0,c.setState({"pub":e,"keyword":"","type":"pub","tag":"","title":"@ "+e,"show":!0},function(){return c.getPost()})},c.onPost=function(e){g.default.navigateTo({"url":"/pages/post/index?&id="+e})},c.onSearch=function(e){var t=e.detail.value.toLowerCase();c.setState({"keyword":""}),c.searchTag(t)},c.searchTag=(o=_asyncToGenerator(f.default.mark(function _callee4(t){var n,o;return f.default.wrap(function _callee4$(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,g.default.request({"url":m.Uri+"daily/v1/tags/search?query="+t});case 2:n=e.sent,o=n.data.hits.map(function(e){return e.name}),c.setState({"hits":o});case 5:case"end":return e.stop()}},_callee4,d)})),function(e){return o.apply(this,arguments)}),c.onNext=function(){c.props.indexStore.more&&(c.props.indexStore.page+=1,c.getPost(!1))},c.onTag=function(e){c.props.indexStore.page=0,c.setState({"tag":e,"keyword":"","pub":"","type":"tag","title":"# "+e,"show":!0},function(){return c.getPost()})},c.onChangeTab=function(e){var t=c.props.indexStore;c.setState({"showTabsOptions":!1}),t.setting.tabId!==e&&(t.page=0,2!==e&&t.setSetting("tabId",e),c.setState({"showTabsOptions":!1,"keyword":"","pub":"","tag":"","type":"latest"},function(){c.getPost()}))},c.onLikeTag=function(t){var e=c.props.indexStore,n=e.tags,o=e.auth.openid;n.includes(t)?n=n.filter(function(e){return e!==t}):n.push(t),c.props.indexStore.tags=n,g.default.request({"url":m.Uri+"user/me","method":"POST","data":{"uid":o,"platform":"wechat","tag":t}})},c.onLikePub=function(t){var e=c.props.indexStore,n=e.pubs,o=e.auth.openid;n.includes(t)?n=n.filter(function(e){return e!==t}):n.push(t),c.props.indexStore.pubs=n,g.default.request({"url":m.Uri+"user/me","method":"POST","data":{"uid":o,"platform":"wechat","pub":t}})},c.savePosts=(n=_asyncToGenerator(f.default.mark(function _callee5(t){var n,o;return f.default.wrap(function _callee5$(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,g.default.request({"url":"https://daily.leeapps.cn/post/create","method":"POST","data":{"list":t}});case 2:return n=e.sent,o={},0===n.data.code&&n.data.data.forEach(function(e){o[e.id]=e.title}),e.abrupt("return",o);case 6:case"end":return e.stop()}},_callee5,d)})),function(e){return n.apply(this,arguments)}),c.onTabs=function(){var e=c.state,t=e.showTabsOptions;if(!e.show)return c.setState({"show":!0});c.setState({"showTabsOptions":!t})},c.onShowPage=function(){var e=c.state.show,t=c.props.indexStore;e&&!t.favsDone&&t.getFavPosts(),c.setState({"show":!e})},c.customComponents=["Setting","IconFont","Post","Loading"],_possibleConstructorReturn(c,t)}c=(0,i.__decorate)([(0,s.inject)("indexStore"),s.observer],c),t.default=c,Component(n(0).default.createComponent(c,!0))}},[[43,0,1,2]]]);